## 양방향 연관관계와 연관관계의 주인

> 중요!

- 객체와 테이블의 패러다임 차이, 이 둘간의 차이가 어디에서 오는지를 알아야 한다.

### 양방향 매핑

- Member에서 Team은 갈 수 있었다.
- 하지만 Team에서는 Member로 갈 수 없었음.

- 이 레퍼런스(참조)를 넣는게 양방향 매핑

- 테이블 연관관계에서는 차이가 없다.
- 왜?

- 멤버의 정보로 팀을 알고 싶을 때 Join 하면 된다.

- member테이블과 Team 테이블을 Join 후, member속 외래키인 Team_ID(FK)로 찾으면 될 일

```SQL
select * from member m
join Team t
```

- 하지만 객체에서는 Team 객체 안에 List members 필요

```java
@OneToMany(mappedBy = "team")
private List<Member> members = new ArrayList<>();
```

- members 리스트를 가지고 있는다.
- @OneToMany(mappedby = "team")
- 이 team 은 여러 member와 연관관계가 있다.
- member와 연관관계가 있는 변수는 team이다.

```java
//main

Member findMember = em.find(Member.class, member.getId());
List<Member> members = findMember.getTeam().getMembers();
```

### 양방향 연관이 좋나? - 사실 객체에서는 단방향이 좋긴 함.

```
mappedBy
```

## 연관관계의 주인과 mappedby

- 객체와 테이블간 연관관계를 맺는 차이를 이해해야 한다.

### 객체와 테이블이 관계를 맺는 차이

- 객체 연관관계 = 2개

  - Member -> Team

  - Team -> Member

  - 단방향 연관관계가 2개 있는 것 = 참조가 두 객체에 있어야 한다.

- 테이블 연관관계 = 1개

  - 외래키

  - 이 외래키 하나만으로 양쪽을 알 수 있음.

### 객체의 양방향 관계 = 단방향 2개

- 양방향 참조하기 위해, 단방향 연관관계 2개를 만들어야 한다.

- 테이블은 Join을 통해 외래키 하나로 서로 알 수 있음.

### 딜레마 : 나는 둘중 뭘로 외래키를 관리해야 하나?

- Member의 team을 바꾸고 싶다면

- 1. Member 객체 안에있는 Team team 을 수정해야 하나?

- 2. Team 객체 안에 있는 List Members 를 수정해야 하나?

- 테이블의 Foreign Key를 무엇이랑 매핑해놔야 하나?

### Rule . 둘 중 하나를 외래키랑 매핑해야 한다 = 연관관계의 주인

- Member의 Team team이 주인이 될래?

- Team의 list members 가 주인이 될래?

- 객체의 두 관계 중 하나를 연관관계의 주인으로 지정
- 연관관계의 주인만이 외래키를 관리(등록, 수정)

- 주인이 아닌쪽은 `읽기`만 가능

- 주인 : mappedBy 속성 사용 못함

- 주인이 아니면 mappedBy 속성으로 주인 지정

- 그리고 답이 있음

- mappedby 가 적힌 곳은 나는 관리되는 입장이다. 나는 읽기만 할 수 있다.

- 위 예제에서 list members에 뭔가 입력해도 db에 반영되지 않는다.

- **외래키가 있는 곳이 주인이 된다.**

- MEMBER 테이블의 TEAM_ID(FK) 라면, Member객체의 Team team을 주인으로, Team객체의 List members를 mappedby로 지정

- 비즈니스적으로 중요하다기 보단 매핑(연관관계) 관리 난이도 때문에 이렇게.
